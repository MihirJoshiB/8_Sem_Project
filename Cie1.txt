create table S_Attendance(
Student_id int primary key,
January int not null,
February int not null,
March int not null,
P_Percentage decimal (7,2)); 

create table Not_Allowed(
S_id int references S_Attendence(Student_id),
Allowed_or_not varchar(10));

insert into S_Attendance (Student_id,January,February,March) values (01,12,11,20);
insert into S_Attendance (Student_id,January,February,March) values (02,15,22,22);
insert into S_Attendance (Student_id,January,February,March) values (03,22,22,15);
insert into S_Attendance (Student_id,January,February,March) values (04,11,23,10);
insert into S_Attendance (Student_id,January,February,March) values (05,11,21,5);

drop procedure P_Not_Allowed;
delimiter //
create procedure P_Not_Allowed()
begin
	declare V_S_id int;
	declare V_Jan int;
	declare V_feb int;
	declare V_Mar int;
	declare V_Percentage int;
	declare V_Total_allow int;
	declare C_Attendance cursor for select Student_id,January,February,March,P_Percentage from 				S_Attendance;

	open C_Attendance;
		label1:Loop
			fetch C_Attendance into V_S_id,V_Jan,V_feb,V_Mar,V_Percentage;
	
			V_Total_allow=V_Jan+V_feb+V_Mar*100/300;
	
			if V_Total_allow>30 then
				set V_Percentage=V_Total_allow;
			else	
				set Student_id=S_id;
				set Allowed_or_not="Not Allowed";
			end if;
		end loop label1;
	close C_Attendance;
end//
delimiter ;
call C_Attendance();
=================================================================================
Delimiter //
create function P_Lowest_Attendance()
returns int
begin
	declare S_id int;
	declare V_January ,V_february int;
	declare V_march,V_Total int;

	select Student_id,January,February,March into S_id,V_January,V_february,V_march from Student_Attendance;

	label:loop	
		V_Total=V_January+V_february+V_march/3;
		select V_Total;

		if (V_Total<50) then 
			select V_Total,S_id from Student_Attendance;
		end if;
	end loop label;
	return S_id;
end//
delimiter ;
call P_Lowest_Attendance();
